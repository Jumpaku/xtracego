#$schema: https://raw.githubusercontent.com/Jumpaku/cyamli/refs/heads/main/v2/schema/cyamli-cli.schema.json
name: xtracego
options:
  -verbose:
    type: boolean
    short: -v
    propagates: true
    description: |
      Whether to output verbose messages or not.
  -trace-stmt:
    type: boolean
    propagates: true
    negation: true
    description: |
      Whether trace basic statements or not.
  -trace-var:
    type: boolean
    propagates: true
    negation: true
    description: |
      Whether trace variables and constants or not.
  -trace-call:
    type: boolean
    propagates: true
    negation: true
    description: |
      Whether trace calling functions and methods or not.
  -trace-case:
    type: boolean
    propagates: true
    negation: true
    description: |
      Whether trace cases of switch and select statements or not.

subcommands:

  rewrite:
    description: |
      Rewrites the source files in the specified package and places these files in the output directory.
      The rewritten files includes Go code to log trace information.
      If go.mod of the module of the package is found, it is copied to the output directory.
    options:
      -output-directory:
        short: -o
        description: |
          Output directory to place the rewritten source files of the package.
          This option is required.
    arguments:
      - name: package
        variadic: true
        description: |
          Path to a local directory of the main package or paths to source files in the package to be rewritten.

  build:
    description: |
      Rewrites the source files in the specified package and places these files in the build directory.
      Executes go build at the specified directory with the given arguments.
    options:
      -go-build-arg:
        short: -a
        repeated: true
        description: |
          Arguments to be passed to the go build command.
          If there are multiple arguments for go build, this option can be specified multiple times.
      -build-directory:
        short: -o
        description: |
          The source files included the specified package are rewritten and placed in this directory which is used as a current working directory to execute go build.
          This option is required.
    arguments:
      - name: package
        variadic: true
        description: |
          Path to a local directory of the main package or paths to source files in the package to be rewritten.

  run:
    description: |
      Rewrites the source files in the specified package and places these files in a temporary directory.
      Executes go build at the temporary directory with the given arguments.
      Thereafter, the built executable file is executed at the current working directory.
    options:
      -go-build-arg:
        short: -a
        repeated: true
        description: |
          Arguments to be passed to the go run command.
          If there are multiple arguments for go build, this option can be specified multiple times.
    arguments:
      - name: package_and_arguments
        variadic: true
        description: |
          Path to a local directory of the main package or paths to source files in the package to be rewritten, followed by arguments to be passed to the main function.
          If a local directory is given as the first argument, the rest of the arguments is treated as arguments to the main function.
          If source files, each of which ends with '.go', are given as the first arguments, the rest of the arguments is treated as arguments to the main function.
          Arguments after the first '--' are treated as arguments to the main function.
          * Example 1:
            xtracego run /path/to/main/package arg1 arg2 --> package=/path/to/main/package, arguments=[arg1, arg2]
          * Example 2:
            xtracego run ./path/to/main/package arg1 arg2 --> package=./path/to/main/package, arguments=[arg1, arg2]
          * Example 3:
            xtracego run ./path/to/main/package -- arg1 arg2 --> package=./path/to/main/package, arguments=[arg1, arg2]
          * Example 4:
            xtracego run ./source.go ./files.go ./arg.go arg1 arg2 --> package=[./source.go, ./files.go, ./arg.go], arguments=[arg1, arg2] 
          * Example 5:
            xtracego run ./source.go ./files.go -- ./arg.go arg1 arg2 --> package=[./source.go, ./files.go], arguments=[./arg.go, arg1, arg2] 
          
